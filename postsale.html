<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gesti√≥n Center ‚Äì PS Auto (Resumen por pa√≠s)</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
  <style>
    /* ===== Estilos id√©nticos a opo11.html ===== */
    :root{
      --bg-app:#1c2a45; --bg-aside:#152035; --txt:#ffffff; --txt-muted:#cfd8dc; --hover:#1c2a45;
      --primary-color:#0d47a1; --accent-color:#42a5f5; --table-bg:#22314f; --table-border:#2f446a; --header-bg:#0d47a1;
      --green-color:#2e7d32; --red-color:#c62828; --orange-color:#f57c00;
    }
    body{ margin:0; font-family:'Lexend',sans-serif; background:var(--bg-app); color:var(--txt); display:flex; min-height:100vh; }
    aside{ background:var(--bg-aside); width:220px; height:100vh; padding:40px 20px; box-sizing:border-box; display:flex; flex-direction:column; position:fixed; left:0; top:0; }
    .logo{ font-size:22px; font-weight:700; margin-bottom:32px; text-align:center; line-height:1.2; }
    nav a{ color:var(--txt); margin:14px 0; text-decoration:none; font-size:15px; padding:10px 12px; border-radius:8px;
      transition:background-color .25s,transform .05s; display:flex; align-items:flex-start; gap:10px; width:100%;
      box-sizing:border-box; white-space:normal; line-height:1.2; overflow-wrap:anywhere; word-break:break-word; }
    nav a:hover{ background:var(--hover); }
    nav a.active{ background:var(--hover); box-shadow:inset 0 0 0 1px rgba(255,255,255,.12); }
    .spacer{ flex:1; }

    main{ margin-left:220px; padding:28px; width:calc(100% - 220px); box-sizing:border-box; }
    .page-title{ display:flex; align-items:center; gap:12px; font-size:24px; font-weight:700; margin:0 0 4px; }
    .subtitle{ margin:0 0 8px; color:var(--txt-muted); font-size:14px; display:flex; align-items:center; gap:10px; }

    .datetime{ font-size:14px; font-weight:600; margin:8px 0 14px; opacity:.9; } /* ‚Üê igual posici√≥n/tama√±o */

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 14px; }
    button{ padding:10px 14px; font-size:14px; cursor:pointer; border:none; border-radius:10px; background:var(--primary-color); color:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,.25); transition:background .2s,transform .03s; }
    button:hover{ background:var(--accent-color); }
    button:active{ transform:translateY(1px); }

    textarea{ width:100%; min-height:160px; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; padding:12px;
      border:1px solid var(--accent-color); background:var(--table-bg); color:var(--txt); border-radius:12px; box-sizing:border-box; }

    table{ margin-top:16px; border-collapse:separate; border-spacing:0; width:100%; background:var(--table-bg); border:1px solid var(--table-border);
      border-radius:12px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.18); }
    th,td{ border-bottom:1px solid var(--table-border); padding:10px; text-align:center; }
    thead th{ background:var(--header-bg); color:#fff; }
    thead th:first-child, tbody td:first-child{ text-align:left; }
    tfoot td{ font-weight:800; background:rgba(66,165,245,.16); border-top:2px solid var(--table-border); }

    /* ‚ÄúPills‚Äù y estados suaves */
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#334766;border:1px solid #2a3d5e}
    .ok{ background:rgba(46,125,50,.15) }
    .warn{ background:rgba(255,193,7,.18) }
    .bad{ background:rgba(198,40,40,.18) }
  </style>
</head>
<body>
  <!-- ===== Sidebar (id√©ntico) ===== -->
  <aside>
    <div class="logo">üß≠ Gesti√≥n Center</div>
    <nav>
      <a href="index.html">üè† Inicio</a>
      <a href="plandetrabajo.html">‚úÖ Plan de trabajo</a>
      <a href="distribucion.html">üìã Distribuci√≥n</a>
      <a href="estadisticas.html">üìà Estad√≠sticas</a>
      <a href="cobertura.html">üåé Cobertura</a>
      <a href="camprev.html">üë• Selector de Apoyo Ver 2.0</a>
      <a href="opo11.html">üß∞ New Report CC Per√∫</a>
      <a class="active" href="#">üöö PS Auto (Resumen)</a>
    </nav>
    <div class="spacer"></div>
  </aside>

  <!-- ===== Main ===== -->
  <main>
    <div class="page-title">üöö Post-Sale Auto ‚Äì Resumen por pa√≠s</div>
    <p class="subtitle">Pega el bloque tal cual (con tabuladores) y genera la tabla compacta.</p>

    <!-- Fecha y hora ‚Äî MISMO lugar / estilo que opo11 -->
    <div class="datetime" id="fechaHora"></div>

    <div class="toolbar">
      <button onclick="procesar()">‚öôÔ∏è Procesar</button>
      <button onclick="limpiar()">üßπ Limpiar</button>
      <button onclick="alternarMapeo()">üß≠ Cambiar mapeo</button>
    </div>

    <textarea id="input" placeholder="Pega aqu√≠ las filas con encabezados (Country, Description/Name, Number of operators, Capacity, Orders)‚Ä¶"></textarea>

    <table id="out">
      <thead>
        <tr>
          <th>Country</th>
          <th>Queues</th>
          <th>Number of operators</th>
          <th>Orders available</th>
          <th>Total orders</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td style="font-weight:800">TOTAL</td>
          <td></td>
          <td id="t_ops"></td>
          <td id="t_av"></td>
          <td id="t_tot"></td>
        </tr>
      </tfoot>
    </table>
  </main>

  <script>
    /* ===== Fecha y hora: id√©ntico comportamiento que opo11 ===== */
    const pad2=n=>String(n).padStart(2,'0');
    function actualizarFechaHora(){
      const ahora=new Date();
      const fecha=ahora.toLocaleDateString('es-PE',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
      const hora =ahora.toLocaleTimeString('es-PE',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
      document.getElementById('fechaHora').textContent=`üìÖ ${fecha} ‚Äì üïí ${hora}`;
    }
    actualizarFechaHora(); setInterval(actualizarFechaHora,1000);

    /* ===== Parser & l√≥gica (igual que antes) ===== */
    // Mapeo por defecto + alternativo (Orders available: capacity[0] o capacity[1])
    let MAP = { queues:"Description|Name", operators:"Number of operators", capacity:"Capacity", orders:"Orders" };
    function alternarMapeo(){
      MAP._alt = !MAP._alt;
      alert(MAP._alt
        ? "Mapeo alternativo:\nOrders available = segundo n√∫mero de Capacity (despu√©s de ‚Üí)"
        : "Mapeo por defecto:\nOrders available = primer n√∫mero de Capacity (antes de ‚Üí)");
    }

    function limpiar(){
      input.value=''; document.querySelector('#out tbody').innerHTML='';
      t_ops.textContent=''; t_av.textContent=''; t_tot.textContent='';
    }

    const input = document.getElementById('input');
    const t_ops = document.getElementById('t_ops');
    const t_av  = document.getElementById('t_av');
    const t_tot = document.getElementById('t_tot');

    const getIdx=(headers, names)=>{
      const list = names.split('|').map(s=>s.trim().toLowerCase());
      for(let i=0;i<headers.length;i++) if(list.includes(headers[i].trim().toLowerCase())) return i;
      return -1;
    };
    const num  = x => { if(x==null) return 0; const m=String(x).match(/-?\d+/); return m?parseInt(m[0],10):0; };
    const pair = (text, splitter) => String(text||'').split(splitter).map(t=>num(t)).slice(0,2).concat([0,0]).slice(0,2);

    function claseSemaforo(val){
      if(val<=0) return 'bad';
      if(val<=5) return 'warn';
      return 'ok';
    }

    function procesar(){
      const raw = input.value.trim();
      if(!raw){ alert('Pega el bloque con encabezados.'); return; }

      const rows = raw.split('\n').map(r=>r.split('\t'));
      const headers = rows[0];

      const ixCountry = getIdx(headers, 'Country');
      const ixQueues  = getIdx(headers, MAP.queues);
      const ixOps     = getIdx(headers, MAP.operators);
      const ixCap     = getIdx(headers, MAP.capacity);
      const ixOrders  = getIdx(headers, MAP.orders);

      if([ixCountry,ixQueues,ixOps,ixCap,ixOrders].some(x=>x<0)){
        alert('No encontr√© alguna columna requerida (Country, Description/Name, Number of operators, Capacity, Orders).');
        return;
      }

      const tbody = document.querySelector('#out tbody');
      tbody.innerHTML='';

      let totalOpsL=0, totalOpsR=0, totalAvail=0, totalOrders=0;

      for(let i=1;i<rows.length;i++){
        const r = rows[i]; if(!r.length) continue;

        const country = (r[ixCountry]||'').toString().replace(/^\s*\d+\.\s*/,'').trim();
        const queues  = (r[ixQueues]||'').toString().trim();
        const opsTxt  = (r[ixOps]||'').toString().trim();       // "3 | 1"
        const capTxt  = (r[ixCap]||'').toString().trim();       // "31 -> 118"
        const ordTxt  = (r[ixOrders]||'').toString().trim();    // "143 | 0"

        const cap = pair(capTxt, '->');  // [a,b]
        const ord = pair(ordTxt, '|');   // [a,b]

        const ordersAvailable = MAP._alt ? cap[1] : cap[0];
        const totalOrd = ord[0];

        const ops = pair(opsTxt, '|');   // [l,r]
        totalOpsL += ops[0]; totalOpsR += ops[1];
        totalAvail += ordersAvailable; totalOrders += totalOrd;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><strong>${country}</strong></td>
          <td><span class="pill">${queues}</span></td>
          <td>${opsTxt||'‚Äì'}</td>
          <td class="${claseSemaforo(ordersAvailable)}">${ordersAvailable}</td>
          <td class="${totalOrd===0?'bad': (totalOrd<10?'warn':'ok')}">${totalOrd}</td>
        `;
        tbody.appendChild(tr);
      }

      t_ops.textContent = `${totalOpsL} | ${totalOpsR}`;
      t_av.textContent  = totalAvail;
      t_tot.textContent = totalOrders;
    }
  </script>
</body>
</html>
