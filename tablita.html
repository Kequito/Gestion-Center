<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gesti√≥n Center ‚Äì Tablas Colaborativas</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
  <style>
    /* ===== Tema base: CLON de 'Estad√≠sticas' ===== */
    :root{
      --bg-app:#1c2a45; --bg-aside:#152035; --txt:#ffffff; --txt-muted:#cfd8dc; --hover:#1c2a45;
      --primary-color:#0D47A1; --accent-color:#42a5f5; --table-bg:#22314f; --table-border:#2f446a; --header-bg:#0d47a1;
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:'Lexend',sans-serif; background:var(--bg-app); color:var(--txt); display:flex; min-height:100vh; }

    /* ===== Sidebar (id√©ntico al doc de Estad√≠sticas) ===== */
    aside{ background:var(--bg-aside); width:220px; height:100vh; padding:40px 20px; display:flex; flex-direction:column; position:fixed; left:0; top:0; }
    .logo{ font-size:22px; font-weight:700; margin-bottom:32px; text-align:center; line-height:1.2; }
    nav a{ color:var(--txt); margin:14px 0; text-decoration:none; font-size:15px; padding:10px 12px; border-radius:8px; transition:background-color .25s,transform .05s; display:flex; align-items:flex-start; gap:10px; width:100%; white-space:normal; line-height:1.2; overflow-wrap:anywhere; word-break:break-word; }
    nav a:hover{ background:var(--hover); }
    nav a.active{ background:var(--hover); box-shadow:inset 0 0 0 1px rgba(255,255,255,.12); }
    .spacer{ flex:1; }

    /* ===== Main ===== */
    main{ margin-left:220px; padding:28px; width:calc(100% - 220px); }
    .page-title{ display:flex; align-items:center; gap:12px; font-size:24px; font-weight:700; margin:0 0 4px; }
    .subtitle{ margin:0 0 10px; color:var(--txt-muted); font-size:14px; display:flex; align-items:center; gap:10px; }

    /* ===== Componentes visuales pulidos ===== */
    .btn{ padding:10px 14px; font-size:14px; cursor:pointer; border:none; border-radius:12px; background:var(--primary-color); color:#fff; box-shadow:0 2px 8px rgba(0,0,0,.25); transition:background .2s,transform .03s; }
    .btn:hover{ background:var(--accent-color); }
    .btn:active{ transform:translateY(1px); }
    .btn-sec{ background:rgba(255,255,255,.05); border:1px solid var(--table-border); color:#fff; border-radius:12px; padding:10px 14px; }
    .btn[disabled]{ opacity:.5; cursor:not-allowed; }
    .pill{ background:rgba(33,150,243,.15); border:1px solid rgba(33,150,243,.35); color:#cfe8ff; border-radius:999px; padding:4px 8px; font-size:12px; }
    .input,.select{ width:100%; background:var(--table-bg); color:#fff; border:1px solid var(--table-border); padding:10px 12px; border-radius:12px; outline:none; }
    .input:focus,.select:focus{ box-shadow:0 0 0 3px rgba(66,165,245,.25); border-color:#4ea2ff; }
    .card{ background:rgba(255,255,255,.04); border:1px solid var(--table-border); border-radius:16px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,.18); }

    table.gc{ width:100%; border-collapse:separate; border-spacing:0; background:var(--table-bg); border:1px solid var(--table-border); border-radius:14px; overflow:hidden; box-shadow:0 4px 14px rgba(0,0,0,.18); position:relative; }
    thead th{ background:var(--header-bg); color:#fff; padding:12px 10px; text-align:left; position:sticky; top:0; z-index:2; user-select:none; }
    tbody td{ padding:10px; border-top:1px solid var(--table-border); }
    tbody tr:nth-child(odd){ background:rgba(255,255,255,.02); }
    tbody tr:nth-child(even){ background:rgba(0,0,0,.06); }

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; margin:12px 0 14px; }

    /* Modales */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal{ width:100%; max-width:56rem; background:var(--bg-aside); border:1px solid var(--table-border); border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
  </style>
</head>
<body>
  <!-- ===== Sidebar ===== -->
  <aside>
    <div class="logo">üß≠ Gesti√≥n Center</div>
    <nav>
      <a href="index.html">üè† Inicio</a>
      <a href="plandetrabajo.html">‚úÖ Plan de trabajo</a>
      <a href="distribucion.html">üìã Distribuci√≥n</a>
      <a href="estadisticas.html">üìà Estad√≠sticas</a>
      <a href="cobertura.html">üåé Cobertura</a>
      <a href="camprev.html">üë• Selector de Apoyo Ver 2.0</a>
      <a href="opo11.html">üß∞ New Report CC Per√∫</a>
      <a href="#contacto">üì¨ Contacto</a>
      <!-- pesta√±a NUEVA al final -->
      <a class="active" href="#">üß© Tablas Colaborativas</a>
    </nav>
    <div class="spacer"></div>
  </aside>

  <!-- ===== Contenido ===== -->
  <main>
    <h1 class="page-title">üìã Tablas Colaborativas</h1>
    <p class="subtitle">Crea, visualiza y edita tablas personalizadas (sin CSV por ahora). Bot√≥n de edici√≥n <strong>por tarjeta</strong>.</p>

    <!-- Toolbar (sin importar/exportar) -->
    <div class="toolbar">
      <button id="btnCreate" class="btn">‚ûï Crear tabla</button>
    </div>

    <!-- Listado de tablas -->
    <section id="tablesGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></section>

    <!-- Editor/Visor -->
    <section id="editorSection" class="hidden">
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-8">
          <div class="flex items-center gap-10">
            <h2 id="editorTitle" class="text-lg font-semibold"></h2>
            <span id="metaCols" class="pill"></span>
            <span id="metaRows" class="pill"></span>
          </div>
          <span id="modePill" class="pill">Modo Vista</span>
        </div>
        <div class="flex items-center gap-8">
          <button id="btnAddRow" class="btn hidden">‚ûï Fila</button>
          <button id="btnAddCol" class="btn-sec hidden">‚ûï Columna</button>
          <button id="btnBack" class="btn-sec">‚üµ Volver</button>
        </div>
      </div>

      <div class="overflow-auto rounded-2xl border border-[var(--table-border)]">
        <table class="gc" id="dataTable">
          <thead><tr id="theadRow"></tr></thead>
          <tbody id="tbodyRows"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal: Crear Tabla (con tipos + sin perder inputs) -->
  <div id="modalCreate" class="modal-backdrop">
    <div class="modal">
      <div class="flex items-center justify-between mb-3"><h3 class="text-lg font-semibold">Crear nueva tabla</h3><button data-close class="btn-sec">‚úñ</button></div>
      <div class="space-y-3">
        <input id="tblName" class="input" placeholder="Nombre de la tabla"/>
        <div id="colsEditor" class="space-y-2"></div>
        <button id="btnAddNewCol" class="btn-sec">‚ûï A√±adir columna</button>
        <div class="flex justify-end gap-2 mt-2"><button data-close class="btn-sec">Cancelar</button><button id="btnConfirmCreate" class="btn">Crear</button></div>
      </div>
    </div>
  </div>

  <!-- Modal: A√±adir Columna (en modo edici√≥n) -->
  <div id="modalAddCol" class="modal-backdrop">
    <div class="modal max-w-lg">
      <div class="flex items-center justify-between mb-3"><h3 class="text-lg font-semibold">A√±adir columna</h3><button data-close-addcol class="btn-sec">‚úñ</button></div>
      <div class="space-y-3">
        <input id="addcolName" class="input" placeholder="Nombre de la columna"/>
        <select id="addcolType" class="select">
          <option value="text">text</option>
          <option value="number">number</option>
          <option value="date">date</option>
          <option value="checkbox">checkbox</option>
          <option value="email">email</option>
          <option value="link">link</option>
          <option value="select">select</option>
        </select>
        <input id="addcolOptions" class="input hidden" placeholder="Opciones para 'select' (coma)"/>
        <div class="flex justify-end gap-2"><button data-close-addcol class="btn-sec">Cancelar</button><button id="btnConfirmAddCol" class="btn">A√±adir</button></div>
      </div>
    </div>
  </div>

  <script>
    // ===== Estado (en memoria) =====
    const state = {
      tables: [],              // {id,name,columns:[{id,name,type,options?}], rows:[{id,cells:[]}]}
      activeId: null,
      editMode: false,
      draftCols: [],           // para el modal de creaci√≥n; no se pierde al a√±adir columnas
    };

    // ===== Refs =====
    const tablesGrid = document.getElementById('tablesGrid');
    const editorSection = document.getElementById('editorSection');
    const editorTitle = document.getElementById('editorTitle');
    const metaCols = document.getElementById('metaCols');
    const metaRows = document.getElementById('metaRows');
    const modePill = document.getElementById('modePill');
    const theadRow = document.getElementById('theadRow');
    const tbodyRows = document.getElementById('tbodyRows');
    const btnCreate = document.getElementById('btnCreate');
    const btnAddRow = document.getElementById('btnAddRow');
    const btnAddCol = document.getElementById('btnAddCol');
    const btnBack = document.getElementById('btnBack');

    // Modales (crear)
    const modalCreate = document.getElementById('modalCreate');
    const tblName = document.getElementById('tblName');
    const colsEditor = document.getElementById('colsEditor');
    const btnAddNewCol = document.getElementById('btnAddNewCol');
    const btnConfirmCreate = document.getElementById('btnConfirmCreate');

    // Modal a√±adir columna
    const modalAddCol = document.getElementById('modalAddCol');
    const addcolName = document.getElementById('addcolName');
    const addcolType = document.getElementById('addcolType');
    const addcolOptions = document.getElementById('addcolOptions');
    const btnConfirmAddCol = document.getElementById('btnConfirmAddCol');

    // ===== Utils =====
    const uid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);
    const now = () => Date.now();
    const open = el => el.style.display='flex';
    const close = el => el.style.display='none';
    const activeTable = () => state.tables.find(t=>t.id===state.activeId) || null;

    function formatLinkDisplay(urlStr){
      if(!urlStr) return '‚Äî';
      try{ const u=new URL(urlStr); return u.hostname.replace(/^www\./,''); }catch{ return 'Abrir'; }
    }

    // ===== Render listado (cada tarjeta con su propio bot√≥n de edici√≥n) =====
    function renderTables(){
      tablesGrid.innerHTML='';
      state.tables.filter(t=>!t.deletedAt).forEach(t=>{
        const rowsCount = t.rows.filter(r=>!r.deletedAt).length;
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
          <div class="flex items-start justify-between">
            <div>
              <div class="font-semibold">${t.name}</div>
              <div class="text-slate-300 text-sm mt-1">${t.columns.length} cols ¬∑ ${rowsCount} filas</div>
            </div>
            <div class="flex items-center gap-2">
              <button class="btn-sec" data-open>üëÅÔ∏è Ver</button>
              <button class="btn-sec" data-edit>‚úèÔ∏è Editar</button>
            </div>
          </div>`;
        card.querySelector('[data-open]').onclick = ()=> openTable(t.id,false);
        card.querySelector('[data-edit]').onclick = ()=> openTable(t.id,true);
        tablesGrid.appendChild(card);
      });
    }

    function openTable(id, goEdit){
      state.activeId = id; state.editMode = !!goEdit;
      editorSection.classList.remove('hidden');
      renderEditor();
    }

    // ===== Render editor =====
    function renderEditor(){
      const t = activeTable(); if(!t){ editorSection.classList.add('hidden'); return; }
      editorTitle.textContent = t.name;
      metaCols.textContent = `${t.columns.length} cols`;
      metaRows.textContent = `${t.rows.filter(r=>!r.deletedAt).length} filas`;
      modePill.textContent = state.editMode ? 'Modo Edici√≥n' : 'Modo Vista';
      btnAddRow.classList.toggle('hidden', !state.editMode);
      btnAddCol.classList.toggle('hidden', !state.editMode);

      // Header de tabla
      theadRow.innerHTML='';
      t.columns.forEach((c, idx)=>{
        const th=document.createElement('th');
        th.innerHTML = state.editMode
          ? `<span class="cursor-pointer underline decoration-dotted" data-rename="${idx}">${c.name}</span> <button class="ml-2" data-delcol="${idx}" title="Eliminar">‚ùå</button>`
          : c.name;
        theadRow.appendChild(th);
      });

      // Cuerpo
      tbodyRows.innerHTML='';
      t.rows.filter(r=>!r.deletedAt).forEach(r=>{
        const tr=document.createElement('tr');
        t.columns.forEach((c, idx)=>{
          const td=document.createElement('td');
          const val = r.cells[idx] ?? '';
          if(!state.editMode){
            if(c.type==='link'){
              const label = formatLinkDisplay(val);
              td.innerHTML = `<a href="${val||'#'}" target="_blank" rel="noopener" style="color:#87cefa;text-decoration:underline">${label}</a>`;
            } else { td.textContent = val; }
          } else {
            if(c.type==='checkbox'){
              const checked = String(val)==='true' || val===true;
              td.innerHTML = `<input type="checkbox" ${checked?'checked':''} data-cell="${r.id}|${idx}">`;
            } else if(c.type==='date'){
              td.innerHTML = `<input class="input" type="date" value="${val}" data-cell="${r.id}|${idx}">`;
            } else if(c.type==='number'){
              td.innerHTML = `<input class="input" type="number" value="${val}" data-cell="${r.id}|${idx}">`;
            } else if(c.type==='email'){
              td.innerHTML = `<input class="input" type="email" value="${val}" data-cell="${r.id}|${idx}">`;
            } else if(c.type==='link'){
              td.innerHTML = `<input class="input" type="url" placeholder="https://" value="${val}" data-cell="${r.id}|${idx}">`;
            } else if(c.type==='select'){
              const opts=(c.options||[]).map(o=>`<option ${o===val?'selected':''}>${o}</option>`).join('');
              td.innerHTML = `<select class="select" data-cell="${r.id}|${idx}"><option value=""></option>${opts}</select>`;
            } else {
              td.innerHTML = `<input class="input" value="${val}" data-cell="${r.id}|${idx}">`;
            }
          }
          tr.appendChild(td);
        });
        tbodyRows.appendChild(tr);
      });

      // Eventos de edici√≥n
      if(state.editMode){
        document.querySelectorAll('[data-cell]').forEach(el=>{
          const [rowId, idxStr]=el.getAttribute('data-cell').split('|');
          const row=t.rows.find(rr=>rr.id===rowId); if(!row) return;
          if(el.type==='checkbox'){ el.onchange=()=>{ row.cells[+idxStr]=el.checked; t.updatedAt=now(); }; }
          else { el.oninput=()=>{ row.cells[+idxStr]=el.value; t.updatedAt=now(); }; }
        });
      }

      // Renombrar / eliminar columna
      theadRow.querySelectorAll('[data-rename]').forEach(el=>{
        el.onclick=()=>{ const idx=+el.getAttribute('data-rename'); const cur=t.columns[idx].name; const name=prompt('Nuevo nombre',cur); if(!name) return; t.columns[idx].name=name; t.updatedAt=now(); renderEditor(); renderTables(); };
      });
      theadRow.querySelectorAll('[data-delcol]').forEach(el=>{
        el.onclick=()=>{ const idx=+el.getAttribute('data-delcol'); if(!confirm('¬øEliminar esta columna?')) return; t.columns.splice(idx,1); t.rows.forEach(r=>r.cells.splice(idx,1)); t.updatedAt=now(); renderEditor(); renderTables(); };
      });
    }

    // ===== Crear tabla =====
    function openCreate(){
      tblName.value='';
      state.draftCols = [ {id:uid('col'),name:'Columna A',type:'text'}, {id:uid('col'),name:'Columna B',type:'text'} ];
      renderColsEditor();
      open(modalCreate);
    }
    function closeCreate(){ close(modalCreate); }

    function renderColsEditor(){
      colsEditor.innerHTML='';
      state.draftCols.forEach((c, idx)=>{
        const row=document.createElement('div'); row.className='grid grid-cols-12 gap-3 items-center';
        const base=document.createElement('div'); base.className='col-span-12 bg-[rgba(255,255,255,.04)] border border-[var(--table-border)] rounded-2xl p-3';
        const grid=document.createElement('div'); grid.className='grid grid-cols-12 gap-3';

        const nameWrap=document.createElement('div'); nameWrap.className='col-span-5';
        const name=document.createElement('input'); name.className='input'; name.placeholder='Nombre de la columna'; name.value=c.name||''; name.oninput=e=>c.name=e.target.value; nameWrap.appendChild(name);

        const typeWrap=document.createElement('div'); typeWrap.className='col-span-3';
        const type=document.createElement('select'); type.className='select'; ['text','number','date','checkbox','email','link','select'].forEach(tt=>{ const o=document.createElement('option'); o.value=tt; o.textContent=tt; type.appendChild(o); });
        type.value=c.type||'text'; type.onchange=e=>{ c.type=e.target.value; renderColsEditor(); }; typeWrap.appendChild(type);

        const optWrap=document.createElement('div'); optWrap.className='col-span-3';
        if(c.type==='select'){
          const opt=document.createElement('input'); opt.className='input'; opt.placeholder="Opciones (coma)"; opt.value=(c.options||[]).join(',');
          opt.oninput=e=>{ c.options = e.target.value.split(',').map(x=>x.trim()).filter(Boolean); }; optWrap.appendChild(opt);
        } else if(c.type==='link'){
          const hint=document.createElement('div'); hint.className='text-xs'; hint.style.color='var(--txt-muted)'; hint.textContent='Se mostrar√° solo el dominio (p. ej. ejemplo.com)'; optWrap.appendChild(hint);
        }

        const actions=document.createElement('div'); actions.className='col-span-1 flex items-center justify-end';
        const del=document.createElement('button'); del.className='btn-sec'; del.textContent='üóë'; del.title='Eliminar'; del.onclick=()=>{ state.draftCols.splice(idx,1); renderColsEditor(); };
        actions.appendChild(del);

        grid.appendChild(nameWrap); grid.appendChild(typeWrap); grid.appendChild(optWrap); grid.appendChild(actions);
        base.appendChild(grid); row.appendChild(base); colsEditor.appendChild(row);
      });
    }

    // ===== Eventos =====
    btnCreate.onclick = openCreate;
    modalCreate.querySelectorAll('[data-close]').forEach(b=> b.onclick = closeCreate);
    btnAddNewCol.onclick = ()=>{ state.draftCols.push({id:uid('col'),name:'',type:'text'}); renderColsEditor(); };
    btnConfirmCreate.onclick = ()=>{
      const name=(tblName.value||'').trim(); if(!name){ alert('Ponle un nombre a la tabla'); return; }
      if(!state.draftCols.length){ alert('A√±ade al menos una columna'); return; }
      const t={ id:uid('tbl'), name, columns: state.draftCols.map(c=>({id:c.id,name:c.name||'Columna',type:c.type||'text',options:c.options||[]})), rows:[], createdAt:now(), updatedAt:now() };
      state.tables.unshift(t); closeCreate(); renderTables(); openTable(t.id,true);
    };

    btnBack.onclick = ()=>{ state.activeId=null; editorSection.classList.add('hidden'); };
    btnAddRow.onclick = ()=>{ const t=activeTable(); if(!t) return; t.rows.unshift({id:uid('row'),cells:t.columns.map(()=> '')}); t.updatedAt=now(); renderEditor(); renderTables(); };
    btnAddCol.onclick = ()=>{ const t=activeTable(); if(!t) return; addcolName.value=''; addcolType.value='text'; addcolOptions.value=''; addcolOptions.classList.add('hidden'); open(modalAddCol); };
    addcolType.addEventListener('change', ()=>{ addcolOptions.classList.toggle('hidden', addcolType.value!=='select'); });
    document.querySelectorAll('[data-close-addcol]').forEach(b=> b.onclick=()=> close(modalAddCol));
    btnConfirmAddCol.onclick = ()=>{
      const t=activeTable(); if(!t) return; const name=(addcolName.value||'').trim(); if(!name){ alert('Nombre de columna'); return; }
      const type=addcolType.value; const options= type==='select' ? addcolOptions.value.split(',').map(x=>x.trim()).filter(Boolean) : [];
      t.columns.push({id:uid('col'),name,type,options}); t.rows.forEach(r=> r.cells.push('')); t.updatedAt=now(); close(modalAddCol); renderEditor(); renderTables();
    };

    // ===== Demo Inicial =====
    (function initDemo(){
      const t={ id:'demo', name:'Ejemplo ‚Äì Turnos OPs', columns:[
        {id:'op',name:'Operador',type:'text'},
        {id:'perop',name:'PEROP1AM',type:'text'},
        {id:'turno',name:'Turno',type:'select',options:['AM (07-16)','PM (13-22)']},
        {id:'desc',name:'Descanso',type:'select',options:['3:00 (15m)','4:00 (15m)','5:00 (45m)','6:00 (45m)']},
        {id:'tl',name:'Team Leader',type:'text'},
        {id:'camp',name:'Campa√±a',type:'text'},
        {id:'ficha',name:'Ficha',type:'link'}
      ], rows:[
        {id:uid('row'),cells:['Jennifer','PEROP1AM-40588','AM (07-16)','3:00 (15m)','Kevin','M√©xico','https://bi.ejemplo.com/reporte/123']},
        {id:uid('row'),cells:['Manuel','PEROP1AM-40453','AM (07-16)','4:00 (15m)','Kevin','M√©xico','https://bi.ejemplo.com/reporte/999']}
      ], createdAt:now(), updatedAt:now() };
      state.tables.push(t); renderTables();
    })();
  </script>
</body>
</html>
