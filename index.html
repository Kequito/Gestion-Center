<!DOCTYPE html>
<html lang="es" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gesti√≥n Center ‚Äî v2.0</title>

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Lexend:wght@300;400;600;700&display=swap" rel="stylesheet"/>

    <!-- üîí Ocultar hasta validar sesi√≥n -->
    <style>html{visibility:hidden}</style>
    <script type="module" src="./assets/guard.js"></script>

    <style>
      :root{
        --radius:16px; --radius-sm:12px; --radius-xs:10px;
        --font-title:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        --font-body:'Lexend',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        --t-fast:.15s; --t-med:.22s; --t-slow:.6s; --curve:cubic-bezier(.2,.7,.2,1);
        --elev-1:0 6px 20px rgba(0,0,0,.25); --elev-2:0 12px 34px rgba(0,0,0,.35);
        --hover-delay:80ms;
        --sidebar-w:280px;         /* ancho expandido */
        --sidebar-w-compact:72px;  /* ancho compacto  */

        /* Sistema de colores extendido */
        --primary:#5b8bff;
        --accent:#7ae3ff;
        --success:#22c55e;
        --warning:#f59e0b;
        --danger:#ef4444;

        /* Badges / pills */
        --pill-bg:rgba(255,255,255,.06);
        --pill-bd:rgba(255,255,255,.12);
      }
      [data-theme="dark"]{
        --bg-app:#070b1a; --bg-aside:#0c1228;
        --bg-card:linear-gradient(160deg, rgba(17,24,49,.88), rgba(17,24,49,.7));
        --txt:#e9f1ff; --txt-muted:#b8c6de; --stroke:rgba(255,255,255,.10);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; font-family:var(--font-body); color:var(--txt);
        background:
          radial-gradient(1100px 1100px at 10% -10%, color-mix(in oklab, var(--primary) 30%, transparent), transparent 60%),
          radial-gradient(900px 900px at 90% 0%, color-mix(in oklab, var(--accent) 35%, transparent), transparent 55%),
          var(--bg-app);
        overflow-x:hidden;
      }

      /* ===== Reveal ===== */
      @media (prefers-reduced-motion:no-preference){
        .reveal{opacity:0; transform:translateY(8px); will-change:transform,opacity; transition:opacity var(--t-slow) ease, transform var(--t-slow) ease}
        .reveal.show{opacity:1; transform:none}
      }

      /* ===== Sidebar ===== */
      aside{
        position:fixed; inset:0 auto 0 0; width:var(--sidebar-w); z-index:25;
        backdrop-filter:saturate(120%) blur(8px);
        background:color-mix(in oklab, var(--bg-aside) 96%, transparent);
        border-right:1px solid var(--stroke);
        display:flex; flex-direction:column; padding:14px 12px; gap:12px; overflow:auto;
        contain: content; /* rendimiento */
        --pad-x: 10px;
      }
      aside::before, aside::after{
        content:""; position:sticky; display:block; height:14px; pointer-events:none; z-index:5;
      }
      aside::before{ top:0; background:linear-gradient(#0000, rgba(0,0,0,.25)) }
      aside::after{ bottom:0; background:linear-gradient(rgba(0,0,0,.25), #0000) }

      /* Encabezado de marca (rectangular) */
      .brand{
        display:flex; align-items:center; justify-content:center;
        padding:8px 12px; border-radius:12px; /* m√°s rectangular */
        border:1px solid var(--stroke);
        background:linear-gradient(132deg, color-mix(in oklab, var(--primary) 18%, transparent), color-mix(in oklab, var(--accent) 12%, transparent));
        transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) ease;
        will-change: transform;
        text-decoration:none; min-height:54px;
      }
      .brand:hover{ transform:scale(1.01) }
      .brand picture{ display:block; }
      .brand img{ width:160px; height:auto; object-fit:contain; filter:drop-shadow(0 6px 14px rgba(0,0,0,.35)); }

      /* Bot√≥n compact/expand */
      .sidebar-toggle{
        display:flex; align-items:center; justify-content:center;
        gap:8px; width:100%; border:1px solid var(--stroke);
        padding:10px; border-radius:12px; background:rgba(255,255,255,.04);
        color:var(--txt); cursor:pointer; font-weight:700;
        transition:filter var(--t-med) ease, transform var(--t-fast) ease;
      }
      .sidebar-toggle:hover{ filter:brightness(1.05) }
      .sidebar-toggle:active{ transform:translateY(1px) }
      .sidebar-toggle .lbl{ font-size:13px }
      .sidebar-toggle[aria-pressed="true"] .lbl::after{ content:" (compacto)"; opacity:.8; font-weight:600 }

      nav{ position:relative; display:flex; flex-direction:column; gap:10px; }
      .nav-group{
        border:1px solid var(--stroke); border-radius:14px; overflow:hidden;
        background:color-mix(in oklab, var(--bg-aside) 92%, transparent)
      }
      .nav-head{
        width:100%; text-align:left; padding:10px 12px; border:0; background:transparent; color:var(--txt);
        font:700 13px/1 var(--font-title); letter-spacing:.3px; cursor:pointer; display:flex; align-items:center; gap:8px;
      }
      .nav-head .chev{ transition:transform var(--t-med) var(--curve) }
      .nav-group.is-collapsed .nav-head .chev{ transform:rotate(-90deg) }
      .nav-body{ overflow:hidden; transition:grid-template-rows .35s var(--curve), opacity .25s ease; display:grid; grid-template-rows:1fr; opacity:1 }
      .nav-group.is-collapsed .nav-body{ grid-template-rows:0fr; opacity:.0 }
      .nav-body-inner{ min-height:0; padding:6px; display:flex; flex-direction:column; gap:8px }

      .nav-item{
        display:flex; align-items:center; gap:10px; padding:12px var(--pad-x);
        border-radius:10px; text-decoration:none; color:var(--txt); font-size:15px;
        border:1px solid transparent;
        transition:
          background var(--t-med) ease var(--hover-delay),
          transform var(--t-fast) ease var(--hover-delay);
        min-height:40px;
      }
      .nav-item:hover{ background:color-mix(in oklab, var(--bg-aside) 80%, transparent); transform:translateX(2px) }
      .nav-item .label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100% }
      .nav-item.active{
        background:linear-gradient(90deg, color-mix(in oklab, var(--primary) 20%, transparent), color-mix(in oklab, var(--accent) 14%, transparent));
        border-color:var(--stroke)
      }
      .nav-indicator{
        position:absolute; left:6px; width:4px; height:40px; border-radius:0 3px 3px 0;
        background:linear-gradient(180deg, var(--primary), var(--accent));
        box-shadow:0 0 16px color-mix(in oklab, var(--accent) 65%, transparent);
        transition:transform 220ms var(--curve), height 220ms ease;
        will-change: transform, height;
        pointer-events:none;
      }

      /* Foco accesible */
      .nav-item:focus-visible, .nav-head:focus-visible, .sidebar-toggle:focus-visible, .logout:focus-visible, .brand:focus-visible, .kquick .qbtn:focus-visible{
        outline:2px solid color-mix(in oklab, var(--accent) 65%, white);
        outline-offset:2px; border-radius:12px;
      }

      .spacer{flex:1}

      /* Role card */
      .role-card{
        display:flex; align-items:center; gap:10px; padding:10px 12px;
        border-radius:14px; border:1px solid var(--stroke);
        background:color-mix(in oklab, var(--bg-aside) 92%, transparent);
      }
      .role-dot{ width:14px; height:14px; border-radius:50%; box-shadow:0 0 0 3px rgba(255,255,255,.06) inset, 0 0 14px rgba(0,0,0,.25) }
      .role-text small{ color:var(--txt-muted) }
      .role-badge{ font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid var(--stroke); background:rgba(255,255,255,.06) }
      .logout{
        width:100%; border:1px solid var(--stroke);
        background:linear-gradient(180deg, #ef4444, #d62c2c); color:#fff;
        padding:12px; border-radius:12px; cursor:pointer; font-weight:700;
        transition:transform var(--t-fast) ease, filter var(--t-med) ease;
      }
      .logout:hover{filter:brightness(1.05)} .logout:active{transform:translateY(1px)}

      /* ===== Main ===== */
      main{ margin-left:var(--sidebar-w); padding:24px 22px 40px; transition:margin-left var(--t-med) var(--curve) }
      .hero{
        position:relative; border-radius:var(--radius); padding:18px 18px 18px 20px;
        background:linear-gradient(135deg, color-mix(in oklab, var(--primary) 14%, transparent), color-mix(in oklab, var(--accent) 12%, transparent));
        border:1px solid var(--stroke); overflow:hidden;
      }
      .hero h1{margin:0 0 6px; font:700 24px/1.2 var(--font-title)}
      .hero p{margin:0; color:var(--txt-muted); font-size:14px}
      .blob{
        position:absolute; right:-90px; top:-90px; width:240px; height:240px; border-radius:50%;
        background:radial-gradient(circle at 30% 30%, color-mix(in oklab, var(--accent) 40%, transparent), transparent 60%);
        filter:blur(18px); pointer-events:none; transform:translateZ(0);
      }

      /* Barra superior del hero: acciones y notificaciones */
      .hero-bar{
        display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      }
      .hero-right{
        margin-left:auto; display:flex; align-items:center; gap:8px;
      }
      .icon-btn{
        display:inline-flex; align-items:center; justify-content:center;
        width:38px; height:38px; border-radius:10px; border:1px solid var(--stroke);
        background:rgba(255,255,255,.08); cursor:pointer; font-weight:800;
        transition:transform var(--t-fast) ease, filter var(--t-fast) ease;
      }
      .icon-btn:hover{ filter:brightness(1.05) } .icon-btn:active{ transform:translateY(1px) }
      .notif-dot{
        display:inline-grid; place-items:center; min-width:16px; height:16px; padding:0 4px;
        border-radius:999px; font-size:11px; font-weight:800; color:#0b1022;
        background:linear-gradient(180deg, var(--warning), color-mix(in oklab, var(--warning) 65%, white));
        border:1px solid color-mix(in oklab, var(--warning) 60%, white);
        transform:translate(12px,-12px);
      }

      /* Quick Actions */
      .kquick{
        display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;
      }
      .kquick .qbtn{
        display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
        border:1px solid var(--pill-bd); border-radius:999px; background:var(--pill-bg);
        font:600 13px/1 var(--font-body); cursor:pointer;
        transition:transform var(--t-fast) ease, filter var(--t-fast) ease, border-color var(--t-fast) ease;
      }
      .kquick .qbtn:hover{ filter:brightness(1.05); border-color:color-mix(in oklab, var(--primary) 35%, var(--pill-bd)) }
      .kquick .qbtn:active{ transform:translateY(1px) }

      /* KPIs */
      .kpis{
        margin-top:14px;
        display:grid; gap:12px;
        grid-template-columns:repeat(3, minmax(200px,1fr));
      }
      .kpi{
        background:var(--bg-card); border:1px solid var(--stroke); border-radius:14px; padding:14px;
        box-shadow:var(--elev-1);
      }
      .kpi h4{ margin:0 0 6px; font:700 13px/1 var(--font-title); color:var(--txt-muted) }
      .kpi .val{ font:800 26px/1 var(--font-title); letter-spacing:.3px }
      .kpi .trend{ font:600 12px/1 var(--font-body); margin-top:6px; opacity:.9 }
      .trend.up{ color:var(--success) } .trend.down{ color:var(--danger) } .trend.flat{ color:var(--txt-muted) }

      .grid{display:grid; gap:14px; margin-top:16px; grid-template-columns:repeat(2, minmax(290px, 1fr))}
      .card{
        position:relative; border-radius:var(--radius); padding:14px 16px; overflow:hidden; isolation:isolate;
        background:var(--bg-card); border:1px solid var(--stroke); box-shadow:var(--elev-1);
        transition:transform var(--t-med) var(--curve), box-shadow var(--t-med) ease, border-color var(--t-med) ease;
        transform:translateZ(0)
      }
      .card:hover{ transform:translateY(-2px); box-shadow:var(--elev-2); border-color:color-mix(in oklab, var(--primary) 25%, var(--stroke)) }
      .card h3{ margin:0 0 6px; color:var(--txt); font:700 15px/1.1 var(--font-title) }
      .card p{ margin:.25rem 0 .5rem; color:var(--txt-muted); font-size:13px }
      .card a{ display:flex; align-items:center; gap:8px; color:var(--txt); text-decoration:none; padding:8px 0; border-radius:10px }
      .card a span{ opacity:.85; transition:opacity var(--t-fast) ease, transform var(--t-fast) ease }
      .card a:hover span{ opacity:1; transform:translateX(2px) }

      /* Panel de notificaciones */
      .notif-panel{
        position:fixed; right:18px; top:18px; width:360px; max-width:calc(100vw - 32px);
        background:var(--bg-card); border:1px solid var(--stroke); border-radius:14px;
        box-shadow:var(--elev-2); padding:12px; display:none; z-index:40;
      }
      .notif-item{ border:1px solid var(--stroke); border-radius:12px; padding:10px; background:rgba(255,255,255,.04); margin-top:8px }
      .notif-item h5{ margin:0 0 4px; font:700 14px/1 var(--font-title) }
      .notif-item p{ margin:0; font-size:13px; color:var(--txt-muted) }

      /* Panel de configuraci√≥n (modal) */
      .settings-backdrop{
        position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:39;
        backdrop-filter: blur(2px);
      }
      .settings-panel{
        position:fixed; inset:0; display:grid; place-items:center; z-index:40; pointer-events:none;
      }
      .settings-card{
        width:520px; max-width:calc(100vw - 32px);
        background:var(--bg-card); border:1px solid var(--stroke); border-radius:16px;
        box-shadow:var(--elev-2); padding:16px; pointer-events:auto; display:none;
      }
      .settings-card h3{ margin:0 0 10px; font:700 18px/1 var(--font-title) }
      .settings-row{ display:flex; gap:10px; align-items:center; margin:8px 0 }
      .switch{
        appearance:none; width:44px; height:26px; border-radius:999px; position:relative; cursor:pointer;
        background:rgba(255,255,255,.12); border:1px solid var(--stroke); transition:background var(--t-fast) ease;
      }
      .switch::after{
        content:""; position:absolute; left:2px; top:2px; width:20px; height:20px; border-radius:50%;
        background:#fff; transition:transform var(--t-fast) ease;
      }
      .switch:checked{ background:linear-gradient(90deg, var(--primary), var(--accent)) }
      .switch:checked::after{ transform:translateX(18px) }

      /* ===== Sidebar compacto ===== */
      body.sidebar-compact aside{ width:var(--sidebar-w-compact) }
      body.sidebar-compact main{ margin-left:var(--sidebar-w-compact) }
      body.sidebar-compact .brand img{ width:42px }
      body.sidebar-compact .nav-head .txt, body.sidebar-compact .nav-item .label, body.sidebar-compact .sidebar-toggle .lbl, body.sidebar-compact .role-text{ display:none }
      body.sidebar-compact .nav-head{ justify-content:center }
      body.sidebar-compact .nav-group{ gap:0 }
      body.sidebar-compact .nav-item{ justify-content:center; padding-inline:0 }
      body.sidebar-compact .role-card{ justify-content:center; padding:10px }
      .nav-item, .nav-head, .sidebar-toggle, .logout, .brand{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }

      /* ===== Responsive ===== */
      @media (max-width:1080px){
        main{margin-left:0; padding:16px}
        aside{position:sticky; width:auto; inset:auto; border-right:none; border-bottom:1px solid var(--stroke)}
        body.sidebar-compact aside{ width:auto }
        body.sidebar-compact main{ margin-left:0 }
        .grid{grid-template-columns:1fr}
        .kpis{ grid-template-columns:1fr 1fr }
      }
      @media (max-width:640px){
        .kpis{ grid-template-columns:1fr }
      }
    </style>
  </head>
  <body>
    <!-- Fondo en cuadr√≠cula sutil con parallax -->
    <div id="bg-grid" aria-hidden="true" style="
      position:fixed; inset:0; z-index:-1; opacity:.07; pointer-events:none;
      background:
        linear-gradient(color-mix(in oklab, var(--txt) 9%, transparent) 1px, transparent 1px) 0 0 / 28px 28px,
        linear-gradient(90deg, color-mix(in oklab, var(--txt) 9%, transparent) 1px, transparent 1px) 0 0 / 28px 28px;">
    </div>

    <!-- ===== SIDEBAR ===== -->
    <aside class="reveal" id="gc-aside">
      <!-- Brand rectangular con webp + fallback png -->
      <a class="brand" href="./index.html" id="brandLink" aria-label="Inicio" title="Inicio">
        <picture>
          <source srcset="./images/logogestioncenter.webp" type="image/webp"/>
          <img id="brandLogo" src="./images/logogestioncenter.png" alt="Gesti√≥n Center" loading="lazy" decoding="async"/>
        </picture>
      </a>

      <!-- Bot√≥n compact/expand -->
      <button class="sidebar-toggle" id="btnSidebarToggle" aria-pressed="false" title="Compactar / Expandir">
        <span class="icon">‚áÜ</span><span class="lbl">Cambiar ancho</span>
      </button>

      <nav id="gc-nav" role="navigation" aria-label="Navegaci√≥n principal">
        <div class="nav-indicator" aria-hidden="true"></div>

        <a href="./index.html" class="nav-item" title="Inicio">
          üè† <span class="label">Inicio</span>
        </a>

        <!-- REPORTES -->
        <section class="nav-group" data-key="grp-reportes">
          <button class="nav-head" title="Reportes">
            <span class="chev">‚ñæ</span> <span class="txt">üìä Reportes</span>
          </button>
          <div class="nav-body"><div class="nav-body-inner">
            <a href="/reports/newreport.html" class="nav-item" title="New Report">üß∞ <span class="label">New Report</span></a>
            <a href="/reports/psreport.html" class="nav-item" title="Post-Sale Report">üöö <span class="label">Post-Sale Report</span></a>
          </div></div>
        </section>

        <!-- OPERACIONES -->
        <section class="nav-group" data-key="grp-operaciones">
          <button class="nav-head" title="Operaciones">
            <span class="chev">‚ñæ</span> <span class="txt">üõ†Ô∏è Operaciones</span>
          </button>
          <div class="nav-body"><div class="nav-body-inner">
            <a href="/operations/distribucion.html" class="nav-item" title="Distribuci√≥n">üìã <span class="label">Distribuci√≥n</span></a>
            <a href="/operations/biops.html" class="nav-item" title="BI de OPs + Links">üîó <span class="label">BI de OPs + Links</span></a>
          </div></div>
        </section>

        <!-- COBERTURA -->
        <section class="nav-group" data-key="grp-cobertura">
          <button class="nav-head" title="Cobertura">
            <span class="chev">‚ñæ</span> <span class="txt">üåé Cobertura</span>
          </button>
          <div class="nav-body"><div class="nav-body-inner">
            <a href="./cobertura.html" class="nav-item" title="Mapa de cobertura">üó∫Ô∏è <span class="label">Mapa de cobertura</span></a>
            <a href="./newcobertura.html" class="nav-item" title="New Cobertura 1.1">üß≠ <span class="label">New Cobertura 1.1</span></a>
          </div></div>
        </section>

        <!-- UTILIDADES -->
        <section class="nav-group" data-key="grp-utils">
          <button class="nav-head" title="Utilidades">
            <span class="chev">‚ñæ</span> <span class="txt">üß© Utilidades</span>
          </button>
          <div class="nav-body"><div class="nav-body-inner">
            <a href="/utilities/camprev.html" class="nav-item" title="Selector de Apoyo 2.0">üë• <span class="label">Selector de Apoyo 2.0</span></a>
          </div></div>
        </section>
      </nav>

      <div class="spacer"></div>

      <!-- Role card con badge -->
      <div class="role-card" id="roleCard" title="Rango del usuario">
        <div class="role-dot" id="roleDot"></div>
        <div class="role-text">
          <strong id="roleName">Invitado</strong>
          <span class="role-badge" id="roleBadge" style="margin-left:6px">‚≠ê Invitado</span><br/>
          <small id="roleDesc">Acceso limitado</small>
        </div>
      </div>

      <button class="logout" onclick="gcLogout()">Salir</button>
    </aside>

    <!-- ===== CONTENIDO ===== -->
    <main>
      <section class="hero reveal">
        <div class="blob" aria-hidden="true"></div>

        <!-- Barra superior del hero: t√≠tulo + acciones -->
        <div class="hero-bar">
          <div>
            <h1 style="font-family:var(--font-title)">Hola Kevin, listo para romperla hoy üí™</h1>
            <p>Sesi√≥n verificada ‚úÖ | Accesos r√°pidos y estado general.</p>
          </div>

          <div class="hero-right">
            <!-- Notificaciones -->
            <button class="icon-btn" id="btnNotif" aria-label="Notificaciones">
              üîî
              <span id="notifDot" class="notif-dot" style="display:none">0</span>
            </button>
            <!-- Configuraci√≥n -->
            <button class="icon-btn" id="btnSettings" aria-label="Configuraci√≥n">‚öôÔ∏è</button>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="kquick" aria-label="Acciones r√°pidas">
          <button class="qbtn" id="qaBuscarOP">üîç Buscar OP</button>
          <button class="qbtn" id="qaReporteDiario">üìä Reporte diario</button>
          <button class="qbtn" id="qaHoy">üìÖ Hoy</button>
          <button class="qbtn" id="qaDistribucion" onclick="location.href='/operations/distribucion.html'">üìã Distribuci√≥n</button>
          <button class="qbtn" id="qaBI" onclick="location.href='/operations/biops.html'">üîó BI de OPs</button>
        </div>

        <!-- KPIs -->
        <div class="kpis" id="kpiWrap">
          <article class="kpi">
            <h4>Aprobaci√≥n global</h4>
            <div class="val" id="kpiApprove">‚Äî</div>
            <div class="trend flat" id="kpiApproveTrend">Sin cambios</div>
          </article>
          <article class="kpi">
            <h4>OPs activos</h4>
            <div class="val" id="kpiOps">‚Äî</div>
            <div class="trend up" id="kpiOpsTrend">+0 vs ayer</div>
          </article>
          <article class="kpi">
            <h4>Tasa de contacto</h4>
            <div class="val" id="kpiContact">‚Äî</div>
            <div class="trend down" id="kpiContactTrend">-0 vs ayer</div>
          </article>
        </div>
      </section>

      <!-- CARDS -->
      <section class="grid">
        <article class="card reveal" style="--delay:.05s">
          <h3>Reportes</h3>
          <p>Entradas principales del d√≠a a d√≠a.</p>
          <a href="/reports/newreport.html">üß∞ <span>New Report</span></a>
          <a href="/reports/psreport.html">üöö <span>Post-Sale Report</span></a>
        </article>

        <article class="card reveal" style="--delay:.1s">
          <h3>Operaciones</h3>
          <p>Distribuci√≥n y accesos de Business Intelligence.</p>
          <a href="/operations/distribucion.html">üìã <span>Distribuci√≥n</span></a>
          <a href="/operations/biops.html">üîó <span>BI de OPs + Links</span></a>
        </article>

        <article class="card reveal" style="--delay:.15s">
          <h3>Cobertura</h3>
          <p>Geograf√≠a y nuevas versiones.</p>
          <a href="./cobertura.html">üåé <span>Mapa de cobertura</span></a>
          <a href="./newcobertura.html">üß≠ <span>New Cobertura 1.1</span></a>
        </article>

        <article class="card reveal" style="--delay:.2s">
          <h3>Utilidades</h3>
          <p>Herramientas de apoyo a gesti√≥n.</p>
          <a href="/utilities/camprev.html">üë• <span>Selector de Apoyo 2.0</span></a>
        </article>
      </section>
    </main>

    <!-- Panel de Notificaciones -->
    <div class="notif-panel" id="notifPanel" role="dialog" aria-labelledby="notifTitle" aria-modal="true">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px">
        <h3 id="notifTitle" style="margin:0; font:700 16px/1 var(--font-title)">Notificaciones</h3>
        <button class="icon-btn" id="btnNotifClose" aria-label="Cerrar">‚úñÔ∏è</button>
      </div>
      <div id="notifList" style="margin-top:8px">
        <!-- items din√°micos -->
      </div>
    </div>
    <div class="settings-backdrop" id="settingsBackdrop" aria-hidden="true"></div>
    <div class="settings-panel" aria-hidden="true">
      <div class="settings-card" id="settingsCard" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px">
          <h3 id="settingsTitle">Configuraci√≥n</h3>
          <button class="icon-btn" id="btnSettingsClose" aria-label="Cerrar">‚úñÔ∏è</button>
        </div>

        <div class="settings-row">
          <label for="swTheme" style="min-width:180px">Tema claro</label>
          <input type="checkbox" id="swTheme" class="switch" />
        </div>
        <div class="settings-row">
          <label for="swCompact" style="min-width:180px">Sidebar compacta</label>
          <input type="checkbox" id="swCompact" class="switch" />
        </div>
        <div class="settings-row">
          <label for="swAnim" style="min-width:180px">Animaciones</label>
          <input type="checkbox" id="swAnim" class="switch" checked />
        </div>
      </div>
    </div>

    <script type="module">
      // ========= Indicador activo + auto-scroll =========
      const items=[...document.querySelectorAll('nav .nav-item')];
      const indicator=document.querySelector('.nav-indicator');
      const navEl=document.getElementById('gc-nav');

      function setActive(){
        const current=(location.pathname.split('/').pop()||'index.html').toLowerCase();
        let active=items[0];
        items.forEach(a=>{
          const href=(a.getAttribute('href')||'').split('#')[0].split('/').pop().toLowerCase();
          if(href && href===current) active=a;
          a.classList.toggle('active', a===active);
          a.toggleAttribute('aria-current', a===active ? 'page':false);
        });
        if(active){
          const pr=navEl.getBoundingClientRect();
          const r=active.getBoundingClientRect();
          const y=r.top - pr.top + navEl.scrollTop;
          indicator.style.height=r.height+'px';
          indicator.style.transform=`translateY(${y}px)`;
          const margin=16;
          const topNeeded = y - margin;
          const bottomNeeded = y + r.height + margin - navEl.clientHeight;
          if (topNeeded < navEl.scrollTop) navEl.scrollTo({top: topNeeded, behavior:'smooth'});
          else if (bottomNeeded > navEl.scrollTop) navEl.scrollTo({top: bottomNeeded, behavior:'smooth'});
        }
      }
      setActive();
      navEl.addEventListener('scroll', setActive);
      window.addEventListener('resize', setActive);

      // ========= Grupos colapsables con memoria =========
      document.querySelectorAll('.nav-group').forEach(g=>{
        const key=g.dataset.key, head=g.querySelector('.nav-head');
        const saved=localStorage.getItem(key);
        if(saved==='0') g.classList.add('is-collapsed');
        head.addEventListener('click', ()=>{
          g.classList.toggle('is-collapsed');
          localStorage.setItem(key, g.classList.contains('is-collapsed')?'0':'1');
          setActive();
        });
      });

      // ========= Reveal al scroll =========
      const reduced=window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(!reduced && 'IntersectionObserver' in window){
        const io=new IntersectionObserver((entries)=>{
          for(const e of entries){ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); } }
        }, {threshold:.12, rootMargin:'0px 0px -10% 0px'});
        document.querySelectorAll('.reveal').forEach(el=>{
          const delay=el.style.getPropertyValue('--delay')||'0s';
          el.style.transitionDelay=delay; io.observe(el);
        });
      } else { document.querySelectorAll('.reveal').forEach(el=>el.classList.add('show')); }

      // ========= Parallax fondo =========
      const bg=document.getElementById('bg-grid'); let rafId=null;
      function parallax(e){
        const x=(e.clientX/window.innerWidth - .5)*6;
        const y=(e.clientY/window.innerHeight - .5)*6;
        if(rafId) cancelAnimationFrame(rafId);
        rafId=requestAnimationFrame(()=>{ bg.style.transform=`translate(${x}px, ${y}px)`; });
      }
      if(!reduced) window.addEventListener('mousemove', parallax);

      // ========= Role UI (jerarqu√≠a + badge) =========
      const ROLE_STYLE={
        'owner':{name:'Owner',desc:'Control total',badge:'üëë Owner',color:'#f59e0b',gradient:'linear-gradient(135deg,#f59e0b,#8b5cf6,#06b6d4)'},
        'admin':{name:'Admin',desc:'Administraci√≥n',badge:'üõ°Ô∏è Admin',color:'#f59e0b',gradient:'linear-gradient(135deg,#f59e0b,#8b5cf6,#06b6d4)'},
        'supervisor':{name:'Supervisor',desc:'Lidera TLs',badge:'‚≠ê Supervisor',color:'#5b8bff',gradient:'linear-gradient(135deg,#5b8bff,#60a5fa)'},
        'team leader':{name:'Team Leader',desc:'Lidera equipo',badge:'‚≠ê TL',color:'#a78bfa',gradient:'linear-gradient(135deg,#a78bfa,#7c3aed)'},
        'analista':{name:'Analista',desc:'Calidad / Datos',badge:'üìä Analista',color:'#22d3ee',gradient:'linear-gradient(135deg,#22d3ee,#06b6d4)'},
        'calidad':{name:'Calidad',desc:'Auditor√≠a',badge:'üß™ Calidad',color:'#22d3ee',gradient:'linear-gradient(135deg,#22d3ee,#06b6d4)'},
        'operador':{name:'Operador',desc:'Ventas / Gesti√≥n',badge:'‚öôÔ∏è Operador',color:'#22c55e',gradient:'linear-gradient(135deg,#22c55e,#16a34a)'},
        'invitado':{name:'Invitado',desc:'Acceso limitado',badge:'‚≠ê Invitado',color:'#94a3b8',gradient:'linear-gradient(135deg,#94a3b8,#64748b)'}
      };
      function getRole(){
        const qp=new URLSearchParams(location.search).get('role');
        const w=(window.gcRole||'').toString().trim();
        const ls=(localStorage.getItem('gc-role')||'').trim();
        return (qp||w||ls||'Invitado');
      }
      function applyRoleUI(roleRaw){
        const roleDot=document.getElementById('roleDot');
        const roleName=document.getElementById('roleName');
        const roleDesc=document.getElementById('roleDesc');
        const roleBadge=document.getElementById('roleBadge');

        const r=roleRaw.toLowerCase();
        const key=Object.keys(ROLE_STYLE).find(k=>r.includes(k))||'invitado';
        const cfg=ROLE_STYLE[key];

        roleDot.style.background=cfg.gradient;
        roleDot.style.boxShadow=`0 0 0 3px rgba(255,255,255,.06) inset, 0 0 18px ${cfg.color}55`;
        roleName.textContent=cfg.name;
        roleDesc.textContent=cfg.desc;
        roleBadge.textContent=cfg.badge;

        const card=document.getElementById('roleCard');
        card.style.filter = (key==='invitado') ? 'saturate(0.8) brightness(0.95)' : 'none';

        localStorage.setItem('gc-role', cfg.name);
      }
      applyRoleUI(getRole());

      // ========= Compact/Expand =========
      const btnToggle=document.getElementById('btnSidebarToggle');
      const compactKey='gc-sidebar-compact';
      function setCompactState(on){
        document.body.classList.toggle('sidebar-compact', !!on);
        btnToggle.setAttribute('aria-pressed', on ? 'true' : 'false');
        localStorage.setItem(compactKey, on ? '1' : '0');
      }
      btnToggle.addEventListener('click', ()=> setCompactState(!document.body.classList.contains('sidebar-compact')));
      setCompactState(localStorage.getItem(compactKey)==='1');

      // ========= Notificaciones =========
      const notifBtn = document.getElementById('btnNotif');
      const notifPanel = document.getElementById('notifPanel');
      const notifList = document.getElementById('notifList');
      const notifDot  = document.getElementById('notifDot');
      const notifClose= document.getElementById('btnNotifClose');

      async function loadAnnouncements(){
        let items = [
          {title:'Bienvenido üëã', text:'Recuerda revisar Distribuci√≥n antes de iniciar turno.'},
          {title:'Capacitaci√≥n 3:00 PM', text:'Sala 2 (Ops). Asistencia confirmada.'}
        ];
        try{
          const res = await fetch('./assets/announcements.json', {cache:'no-store'});
          if(res.ok){
            const remote = await res.json();
            if(Array.isArray(remote) && remote.length) items = remote;
          }
        }catch(_){} // fallback silencioso
        renderAnnouncements(items);
      }
      function renderAnnouncements(items){
        notifList.innerHTML = '';
        items.forEach(it=>{
          const div = document.createElement('div');
          div.className='notif-item';
          div.innerHTML = `<h5>${it.title||'Anuncio'}</h5><p>${it.text||''}</p>`;
          notifList.appendChild(div);
        });
        if(items.length){
          notifDot.textContent = items.length;
          notifDot.style.display = 'inline-grid';
        }else{
          notifDot.style.display = 'none';
        }
      }
      function toggleNotif(open){
        notifPanel.style.display = open ? 'block' : 'none';
      }
      notifBtn.addEventListener('click', ()=> toggleNotif(notifPanel.style.display!=='block'));
      notifClose.addEventListener('click', ()=> toggleNotif(false));
      window.addEventListener('click', (e)=>{
        if(notifPanel.style.display==='block' && !notifPanel.contains(e.target) && e.target!==notifBtn){
          toggleNotif(false);
        }
      });
      loadAnnouncements();

      // ========= Configuraci√≥n (modal) =========
      const settingsBackdrop = document.getElementById('settingsBackdrop');
      const settingsCard = document.getElementById('settingsCard');
      const btnSettings = document.getElementById('btnSettings');
      const btnSettingsClose = document.getElementById('btnSettingsClose');
      const swTheme = document.getElementById('swTheme');
      const swCompact = document.getElementById('swCompact');
      const swAnim = document.getElementById('swAnim');

      function openSettings(){
        settingsBackdrop.style.display='block';
        settingsCard.style.display='block';
        settingsBackdrop.setAttribute('aria-hidden','false');
      }
      function closeSettings(){
        settingsBackdrop.style.display='none';
        settingsCard.style.display='none';
        settingsBackdrop.setAttribute('aria-hidden','true');
      }
      btnSettings.addEventListener('click', openSettings);
      btnSettingsClose.addEventListener('click', closeSettings);
      settingsBackdrop.addEventListener('click', closeSettings);
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeSettings(); });

      // Prefs
      const THEME_KEY='gc-theme'; // 'dark'|'light'
      function applyTheme(mode){
        const m = mode==='light' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', m);
        localStorage.setItem(THEME_KEY, m);
        swTheme.checked = (m==='light');
      }
      applyTheme(localStorage.getItem(THEME_KEY)||'dark');
      swTheme.addEventListener('change', ()=> applyTheme(swTheme.checked ? 'light' : 'dark'));

      swCompact.checked = localStorage.getItem(compactKey)==='1';
      swCompact.addEventListener('change', ()=> setCompactState(swCompact.checked));

      const ANIM_KEY='gc-anim';
      function applyAnim(on){
        document.documentElement.style.setProperty('--hover-delay', on? '80ms':'0ms');
        localStorage.setItem(ANIM_KEY, on?'1':'0');
      }
      applyAnim(localStorage.getItem(ANIM_KEY)!=='0');
      swAnim.checked = localStorage.getItem(ANIM_KEY)!=='0';
      swAnim.addEventListener('change', ()=> applyAnim(swAnim.checked));

      // ========= KPIs (placeholder con l√≥gica m√≠nima) =========
      function fmtPct(n){ return (Math.round(n*10)/10).toFixed(1)+'%' }
      function setKPIs({approve=87.3, approveTrend=+1.2, ops=142, opsTrend=+5, contact=42.0, contactTrend=-0.7}={}){
        const elA=document.getElementById('kpiApprove');
        const elAT=document.getElementById('kpiApproveTrend');
        const elO=document.getElementById('kpiOps');
        const elOT=document.getElementById('kpiOpsTrend');
        const elC=document.getElementById('kpiContact');
        const elCT=document.getElementById('kpiContactTrend');

        elA.textContent = fmtPct(approve);
        elAT.textContent = (approveTrend>0?'+':'') + fmtPct(Math.abs(approveTrend)) + ' vs ayer';
        elAT.className='trend ' + (approveTrend>0?'up':approveTrend<0?'down':'flat');

        elO.textContent = ops;
        elOT.textContent = (opsTrend>0?'+':'') + Math.abs(opsTrend) + ' vs ayer';
        elOT.className='trend ' + (opsTrend>0?'up':opsTrend<0?'down':'flat');

        elC.textContent = fmtPct(contact);
        elCT.textContent = (contactTrend>0?'+':'') + fmtPct(Math.abs(contactTrend)) + ' vs ayer';
        elCT.className='trend ' + (contactTrend>0?'up':contactTrend<0?'down':'flat');
      }
      // Puedes remplazar esto por un fetch real en el futuro:
      setKPIs();

      // ========= Seguridad: logout expuesto por guard.js =========
      if(typeof window.gcLogout!=='function'){
        console.warn('gcLogout no est√° definido. Exp√≥n: window.gcLogout = async () => { /* signOut + redirect */ }');
      }
    </script>

    <!-- üîí Normalizador de rutas (GitHub Pages / dominio propio) -->
    <script>
    (() => {
      const isGhProject = location.hostname.endsWith('github.io');
      const PROJECT_SLUG = 'Gestion-Center';
      const base = isGhProject ? `/${PROJECT_SLUG}/` : '/';

      document.querySelectorAll('nav a.nav-item[href], .brand[href], .card a[href], .kquick .qbtn[onclick]').forEach(a => {
        // Normaliza <a> y tambi√©n botones con onclick location.href='/...'
        if (a.tagName === 'A') {
          const href = a.getAttribute('href');
          if (!href || href.startsWith('#') || /^https?:\/\//i.test(href)) return;
          const clean = href.replace(/^\.?\//, '');
          a.setAttribute('href', base + clean);
        } else if (a.hasAttribute('onclick')) {
          const js = a.getAttribute('onclick');
          const m = js && js.match(/location\.href=['"]\/([^'"]+)['"]/);
          if (m) a.setAttribute('onclick', `location.href='${base}${m[1]}'`);
        }
      });

      // Normaliza logo (soporta fallback png)
      const logo = document.querySelector('#brandLink img');
      if (logo) {
        let src = logo.getAttribute('src') || './images/logogestioncenter.png';
        if (!/^https?:\/\//i.test(src)) {
          src = src.replace(/^\.?\//, '');
          logo.setAttribute('src', base + src);
        }
        const source = document.querySelector('#brandLink source');
        if (source) {
          let s = source.getAttribute('srcset') || './images/logogestioncenter.webp';
          s = s.replace(/^\.?\//, '');
          source.setAttribute('srcset', base + s);
        }
      }
    })();
    </script>
  </body>
</html>
